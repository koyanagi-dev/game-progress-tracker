# Game Progress Tracker テスト仕様メモ

- バージョン: v0.2
- 対象アプリ: Game Progress Tracker
- 目的:  
  実装済みの機能について、「何を」「どこまで」テストしているかを整理し、  
  追加実装やリグレッションテスト（改修後の再確認）に使えるようにする。

---

## 1. テスト環境の前提

- ランタイム: Node.js 20 系（LTS）
- ビルド: Vite + React
- テストランナー: Vitest v4 系
- UI テスト: React Testing Library（`@testing-library/react`）＋ `@testing-library/user-event`
- 実行コマンド:
  - `npm test`

---

## 2. Kano モデルとテストのざっくり対応

ここでは、各機能をざっくりと以下のように分類する。

- **M（Must-be / 当たり前品質）**  
  ないと不満が爆発するレベルの「最低限」。  
  例: タスクが追加・削除できる、編集しても壊れない 等。

- **O（One-dimensional / 一元品質）**  
  あればあるほど嬉しい。性能や使いやすさに比例して満足度が上がる。  
  例: 並べ替え、バリデーション、カテゴリ絞り込み、永続化 など。

- **A（Attractive / 魅力品質）**  
  なくても困らないが、あると「おっ」と嬉しい。  
  例: ゲームっぽい見た目、カラフルなバッジ 等（現時点ではテスト対象外）

### 2.1 機能 × Kano × テスト有無（要約表）

| ID | 機能                              | Kano | テスト種別        | テストファイル例                          |
|----|-----------------------------------|------|-------------------|-------------------------------------------|
| F1 | タスク追加                        | M    | UI テスト         | `ui-add-task.test.jsx`                    |
| F2 | タスク削除                        | M    | UI テスト         | `ui-delete-task.test.jsx`                 |
| F3 | 状態変更（未着手→...→保留）      | M    | ロジック＋UI      | `tasks.test.js`, `ui-status-change...`    |
| F4 | 並べ替え（昇順・降順・解除）      | O    | ロジック＋UI      | `tasks.test.js`, `ui-sort-task...`        |
| F5 | localStorage 永続化               | O    | ロジック＋UI      | `tasks.test.js`, `ui-storage...`          |
| F6 | タスク編集（保存／キャンセル）    | M    | UI テスト         | `ui-edit-task.test.jsx`                   |
| F7 | 入力バリデーション（空文字）      | M    | UI テスト         | `ui-add-empty-task.test.jsx`              |
| F8 | 入力バリデーション（100文字制限） | O    | UI テスト         | `ui-maxlength.test.jsx`                   |
| F9 | カテゴリ選択＋ラベル表示          | O    | UI テスト（軽め） | （画面確認／将来自動化候補）              |
| F10| カテゴリ絞り込み                  | O    | UI テスト         | `ui-category-filter.test.jsx`             |

---

## 3. 単体テスト（ロジック系）仕様

### 3.1 対象ファイル

- `src/tests/tasks.test.js`

現状は「アプリ内部ロジックが想定通り動くか」をまとめて確認する位置付け。

### 3.2 テストケース（概要）

※ 実際の関数名・テスト名はコードに依存するが、カバーしている観点を言葉で整理。

1. **状態ローテーションの確認**
   - 入力: 各状態（未着手／進行中／完了／保留）
   - 出力:
     - 未着手 → 進行中
     - 進行中 → 完了
     - 完了 → 保留
     - 保留 → 未着手
   - 目的: 状態変更ロジックが正しく循環しているか。

2. **状態ソート（昇順）の確認**
   - 入力: さまざまな状態のタスク配列
   - 出力: 未着手 → 進行中 → 完了 → 保留 の順に並ぶこと
   - 目的: 昇順ソートロジックの検証。

3. **状態ソート（降順）の確認**
   - 入力: さまざまな状態のタスク配列
   - 出力: 保留 → 完了 → 進行中 → 未着手 の順に並ぶこと
   - 目的: 降順ソートロジックの検証。

4. **並べ替え解除用の順序管理の確認**
   - 状態ソート後に「元の追加順」に戻せるかどうかを確認するロジック。
   - 目的: B仕様（ソート中は並び固定／解除で元に戻る）のベースになる部分の確認。

5. **永続化（localStorage 相当ロジック）の確認**
   - 保存用データの形・復元時のデータ補正（不正な状態のデフォルト化など）を確認。
   - 目的: localStorage による復元処理が不正データでも落ちずに扱えること。

---

## 4. UI テスト仕様（画面操作系）

ここからは `src/tests` 配下の UI テストについて、  
「何を意図して書いているか」を整理する。

### 4.1 タスク追加（UI）

- **ファイル:** `src/tests/ui-add-task.test.jsx`  
- **目的:**  
  「入力して 追加 を押すと、画面上にタスクが表示される」ことの確認。
- **主な流れ:**
  1. アプリをレンダリング。
  2. テキスト欄に「テストタスク」と入力。
  3. 「追加」ボタンをクリック。
  4. 画面内に「テストタスク」というテキストが表示されることを確認。
- **Kano:** M（当たり前品質：ないとアプリとして成立しない）

---

### 4.2 タスク削除（UI）

- **ファイル:** `src/tests/ui-delete-task.test.jsx`  
- **目的:**  
  追加したタスクを削除すると、画面から消えることを確認する。
- **主な流れ:**
  1. 「テストタスク」を追加。
  2. そのタスク行の「❌ 削除」ボタンをクリック。
  3. 画面から「テストタスク」のテキストが消えることを確認。
- **Kano:** M（当たり前品質：削除できないと困る）

---

### 4.3 状態変更（UI）

- **ファイル:** `src/tests/ui-status-change.test.jsx`  
- **目的:**  
  「🔄 状態変更」ボタンをクリックするたびに状態がローテーションすることを確認。
- **主な流れ:**
  1. 「状態テストタスク」を追加（初期状態は未着手）。
  2. 状態表示が「未着手」であることを確認。
  3. 「🔄 状態変更」クリック → 「進行中」に変わることを確認。
  4. さらにクリック → 「完了」に変わることを確認。
  5. さらにクリック → 「保留」に変わることを確認。
  6. さらにクリック → 再び「未着手」に戻ることを確認。
- **Kano:** M（当たり前品質）

---

### 4.4 並べ替え（状態ソート）＋仕様 B 確認

- **ファイル:** `src/tests/ui-sort-task.test.jsx`  
- **目的:**  
  状態ソートの UI と、B仕様（ソート中は並びが固定される）の確認。

- **テストケース:**

1. **昇順ボタンで状態順（未着手→進行中→完了→保留）に並ぶ**
   - 4 つのタスクを、さまざまな状態に設定。
   - 「状態の昇順」ボタンを押して、並び順を確認。

2. **降順ボタンで状態順（保留→完了→進行中→未着手）に並ぶ**
   - 同様に「状態の降順」ボタンで並び順を確認。

3. **並べ替え解除で元の追加順（タスク1→4）が復元される**
   - 昇順 or 降順で並べ替えたあと、「並べ替え解除」で元の追加順に戻ること。

4. **昇順ソート中に状態変更しても、タスクの並び順は変わらない**
   - 昇順ソート適用 → 任意のタスクの状態を変える。
   - 並び順（タスク名の順番）は変化しないことを確認。

5. **降順ソート中に状態変更しても、タスクの並び順は変わらない**
   - 降順ソート適用 → 任意のタスクの状態を変える。
   - 並び順が変わらないことを確認。

- **Kano:** O（一元品質：並べ替えの気持ちよさが満足度に比例）

---

### 4.5 空文字バリデーション（追加時）

- **ファイル:** `src/tests/ui-add-empty-task.test.jsx`  
- **目的:**  
  空文字やスペースだけではタスクが追加されないことを確認。
- **主な流れ:**
  1. 入力欄を空のまま「追加」 → 何も増えない。
  2. 半角スペースや全角スペースだけ入力して「追加」 → 何も増えない。
- **Kano:** M（当たり前品質：ゴミデータ防止）

---

### 4.6 タスク名の最大長（100文字制限）

- **ファイル:** `src/tests/ui-maxlength.test.jsx`  
- **目的:**  
  タスク名が 100 文字まで許容され、それ以上は切り捨てられることを確認。
- **主な流れ:**
  1. ちょうど 100 文字の文字列で追加 → そのまま表示されること。
  2. 101 文字以上の文字列で追加 → 表示上は 100 文字に切り詰められていること。
- **Kano:** O（一元品質：入力制御が適切だと安心感アップ）

---

### 4.7 編集機能（保存／キャンセル／バリデーション）

- **ファイル:** `src/tests/ui-edit-task.test.jsx`  
- **目的:**  
  タスク編集の基本パターンを網羅的に確認。

- **テストケース:**

1. **CASE1: 編集 → 保存 で名前が更新される**
   - 「最初の名前」でタスク追加。
   - 編集モードに入り、「編集後の名前」に変更して「保存」。
   - 表示が「編集後の名前」になっていること。

2. **CASE2: 編集 → キャンセル では変更が反映されない**
   - 「キャンセルテスト」でタスク追加。
   - 編集モードに入り、一旦別の名前に変更する。
   - 「キャンセル」を押す。
   - 表示は元の「キャンセルテスト」のままであること。

3. **CASE3: 編集モードの UI が正しく切り替わる**
   - 編集前: 「✏️ 編集」「🔄 状態変更」「❌ 削除」ボタンが見えている。
   - 編集中: 入力欄＋「💾 保存」「↩️ キャンセル」が見えて、元の三つは消えている。
   - キャンセル or 保存後: 元のボタン構成に戻る。

4. **CASE4: 空文字で保存してもタスク名は変わらない**
   - 編集モードで入力欄を空にして「保存」。
   - タスク名は元のまま残ること（変更されない）。

- **Kano:** M（当たり前品質：編集が壊れるとストレス大）

---

### 4.8 localStorage による永続化

- **ファイル:** `src/tests/ui-storage.test.jsx`  
- **目的:**  
  タスクを追加したあと、コンポーネントを再マウントしてもデータが復元されることを確認。
- **主な流れ:**
  1. アプリをレンダリング。
  2. 「ストレージテスト」タスクを追加。
  3. コンポーネントをアンマウント → 再マウント（テスト内で実施）。
  4. 再マウント後も「ストレージテスト」が表示されていることを確認。
- **Kano:** O（一元品質：残っていると満足度が上がる）

---

### 4.9 カテゴリ絞り込み

- **ファイル:** `src/tests/ui-category-filter.test.jsx`  
- **目的:**  
  カテゴリプルダウンで絞り込みができること、  
  および「すべて」に戻したときに全タスクが見えることを確認。

- **主な流れ:**
  1. カテゴリの異なるタスクを複数追加（例: メインクエスト／サブクエスト／ボス攻略）。
  2. カテゴリ絞り込みプルダウンで「メインクエスト」を選択。
  3. メインクエストのタスクのみ表示されていることを確認。
  4. 再度「すべて」を選択。
  5. 全てのタスクが表示されていることを確認。

- **Kano:** O（一元品質：分類・管理がしやすくなる）

---

### 4.10 サンプルテスト

- **ファイル:** `src/sample.test.js`  
- **目的:**  
  テスト環境が正常に動くことを確認するためのサンプル（例: `1 + 1 = 2` を確認するようなテスト）。
- **Kano:** 直接的な機能ではないため分類対象外だが、開発体験としての安心感に寄与。

---

## 5. 今後の拡張時のメモ

- もし今後、機能を追加した場合は：
  - 要件定義（`requirements-v0.x.md`）
  - テスト仕様メモ（このファイル）
  - 実際のテストコード（`src/tests/...`）
  の 3 点セットで更新していく。

- 特に「魅力品質（A）」寄りの機能（アニメーション、見た目強化など）を実装した場合、
  - すべてを自動テストする必要はないが、
  - 「壊れると困るところ」だけ軽い UI テストを追加する、という方針が現実的。

---
